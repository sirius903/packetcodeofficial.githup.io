<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css"></link>
</head>
<body>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, setDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCH19uFh4bPcFHJJxLNEnd6syxell55Sqw",
            authDomain: "new-project-6f342.firebaseapp.com",
            projectId: "new-project-6f342",
            storageBucket: "new-project-6f342.appspot.com",
            messagingSenderId: "117809923508",
            appId: "1:117809923508:web:f5b688225998923ecc9ee1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        var rooms = [];
        var ids = [];
        const unsub = onSnapshot(collection(db, "Rooms"), (doc) => {
            rooms = [];
            doc.forEach(a => rooms.push(a.data()));
            ids = rooms.map(x => x.id);
            console.log(rooms);
            console.log(ids);

            document.querySelector('.list_box').innerHTML = '<div class="rooms_item creation"><div id="plus_btn">New Room</div></div>';
            document.querySelector('.creation').addEventListener("click", ()=>{
                document.querySelector('.list_box').className = 'list_box container hidden';
                document.querySelector('.generate').className = 'generate container';
            })
            rooms.forEach(a => {
                let item = document.createElement('div');
                item.className = 'rooms_item';
                let title = document.createElement('div');
                title.className = 'rooms-title';
                title.append(a.name);
                item.append(title);
                let limit = document.createElement('div');
                limit.className = 'rooms-limit';
                limit.append('1 / ' + a.limit);
                item.append(limit);
                document.querySelector('.list_box').append(item)
            })
            for(let i = 3 - rooms.length % 3; i > 1; i--){
                let item = document.createElement('div');
                item.className = 'rooms_item';
                document.querySelector('.list_box').append(item);
            }
        });

        const alph = "ABCDEFGHIJKLMNOPQRSTUVWXYNZ"
        
        const create_bt = document.getElementById('create_button');
        create_bt.addEventListener("click", () => {
            while(true){
                var id = alph[Math.floor(Math.random() * alph.length)] + alph[Math.floor(Math.random() * alph.length)] + alph[Math.floor(Math.random() * alph.length)] + alph[Math.floor(Math.random() * alph.length)]
                if(!ids.find(x => x == id)){
                    break;
                }
            }

            setDoc(doc(db, "Rooms", id), {
                name : document.getElementById('name').value,
                limit : document.getElementById('limit').value,
                id : id
            })
        })
    </script>
    <script>
        function tab(n){
            console.log(1)
            var tabs = document.querySelectorAll('.room_tab');
            tabs.forEach(x => x.className = 'room_tab');
            tabs[n].className += ' active';
            var contents = document.querySelectorAll('.room_content');
            contents.forEach(x => x.className = 'scroller room_content hidden');
            contents[n].className = 'scroller room_content'
        }
    </script>
    <div class="list_box container">
        <div class="rooms_item">
            <div class="rooms-title">드루와</div>
            <div class="rooms-limit">1 / 4</div>
        </div>
        <div class="rooms_item">
            <div class="rooms-title">드루와</div>
            <div class="rooms-limit">1 / 4</div>
        </div>
        <div class="rooms_item">
            <div class="rooms-title">드루와</div>
            <div class="rooms-limit">1 / 4</div>
        </div>
        <div class="rooms_item">
            <div class="rooms-title">드루와</div>
            <div class="rooms-limit">1 / 4</div>
        </div>
    </div>



    <div class="generate container hidden">
        <div></div>
        <div id="room_content_container">
            <h1 id="room_content_name">-</h1>
            <p id="moreinfo">hover over a setting for more info</p>
            <div style="display: flex;">
                <div class="room_tabs flex-column">
                    <div class="room_tab active" onclick="tab(0)">Room</div>
                    <div class="room_tab" onclick="tab(1)">Match</div>
                    <div class="room_tab" onclick="tab(2)">Game</div>
                </div>
                <div class="scroller room_content">
                    <div>
                        <div class="config_row">
                            <div class="config_label flex-item">room name</div>
                            <input id="name" class="config_item flex-item" value="-">
                        </div>
                        <div class="config_row">
                            <div class="config_label flex-item">player limit</div>
                            <input type="number" id="limit" class="config_item flex-item" max="4" min="2" value="2">
                        </div>
                    </div>
                </div>
                <div class="scroller room_content hidden">2</div>
                <div class="scroller room_content hidden">3</div>
            </div>
            <div id="create_button">CREATE</div>
        </div>
        <div></div>
    </div>
</body>
</html>